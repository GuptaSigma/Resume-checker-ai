<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Resume Analysis Results - {{ company_name }}</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
<style>
/* Custom CSS Start */

.score-badge {
    font-size: 1.2rem;
    font-weight: bold;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
}

/* Score colors */
.score-excellent { background-color: #198754; color: white; }
.score-good { background-color: #0dcaf0; color: white; }
.score-average { background-color: #ffc107; color: black; }
.score-poor { background-color: #dc3545; color: white; }

/* Candidate card hover effect */
.candidate-card {
    transition: all 0.3s ease;
    border: 1px solid #dee2e6;
    border-radius: 0.5rem;
}
.candidate-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

/* Warning section gradient background */
.ai-warning {
    background: linear-gradient(45deg, #fff3cd, #f8d7da);
    border: 1px solid #ffeaa7;
    border-radius: 0.5rem;
    padding: 0.75rem 1rem;
}

/* Header section gradient and styling */
.section-header {
    background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
    padding: 1.5rem;
    border-radius: 0.5rem;
    margin-bottom: 2rem;
}

/* Stats card styling */
.stats-card {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 0.5rem;
    padding: 1.5rem;
    text-align: center;
}

/* Button minimal width */
.email-btn {
    min-width: 120px;
}

/* Toast container positioning */
.toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
}
</style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary border-bottom">
    <div class="container">
        <a class="navbar-brand" href="/">
            <i class="fas fa-brain me-2"></i>AI Resume Analyzer
        </a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="/">
                <i class="fas fa-arrow-left me-2"></i>New Analysis
            </a>
        </div>
    </div>
</nav>

<div class="toast-container"></div>

<div class="container my-4">
    <div class="section-header text-center">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div></div>
            <div class="text-center">
                <h1><i class="fas fa-chart-bar me-3"></i>Resume Analysis Results</h1>
                <p class="lead mb-0">{{ company_name }} | Analyzed by {{ hr_name }}</p>
                <p class="text-muted mb-0"><i class="fas fa-phone me-2"></i>Contact: +91 7287827823</p>
            </div>
            <div>
                {% if shortlisted %}
                <a href="{{ url_for('download_report', company_name=company_name) }}" class="btn btn-success btn-lg">
                    <i class="fas fa-download me-2"></i>Download All Selected
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="stats-card">
                <i class="fas fa-file-alt fa-2x text-primary mb-2"></i>
                <h3>{{ total_processed }}</h3>
                <p class="mb-0">Total Processed</p>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="stats-card">
                <i class="fas fa-star fa-2x text-success mb-2"></i>
                <h3>{{ shortlisted|length }}</h3>
                <p class="mb-0">Shortlisted</p>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="stats-card">
                <i class="fas fa-times-circle fa-2x text-danger mb-2"></i>
                <h3>{{ not_selected|length }}</h3>
                <p class="mb-0">Not Selected</p>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="stats-card">
                <i class="fas fa-robot fa-2x text-warning mb-2"></i>
                <h3>{{ (shortlisted + not_selected)|selectattr('is_ai_generated')|list|length }}</h3>
                <p class="mb-0">AI Detected</p>
            </div>
        </div>
    </div>

    <div class="alert alert-info mb-5">
        <h6><i class="fas fa-info-circle me-2"></i>Filter Score Explanation</h6>
        <p class="mb-0">
            <strong>Filter Score:</strong> The percentage score indicates how well a candidate's skills and experience match the job requirements.
            <span class="badge score-excellent ms-2">75%+ = Shortlisted</span>
            <span class="badge score-poor ms-2">&lt;75% = Not Selected</span>
        </p>
    </div>

    {% if shortlisted %}
    <div class="mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="text-success mb-0">
                <i class="fas fa-check-circle me-2"></i>Shortlisted Candidates ({{ shortlisted|length }})
            </h2>
            <a href="{{ url_for('download_report', company_name=company_name) }}" class="btn btn-outline-success">
                <i class="fas fa-download me-2"></i>Download Report
            </a>
        </div>
        <div class="row">
            {% for candidate in shortlisted %}
            <div class="col-lg-6 mb-4">
                <div class="card candidate-card h-100">
                    <div class="card-header d-flex justify-content-between align-items-start">
                        <div>
                            <h5 class="card-title mb-1">
                                <i class="fas fa-user me-2"></i>{{ candidate.name }}
                            </h5>
                            <small class="text-muted">{{ candidate.resume_filename }}</small>
                            
                            <div class="mt-3">
                                <small class="text-muted">Skills Checklist</small>
                                <ul class="list-inline mt-2">
                                    {% for s in candidate.skills %}
                                    <li class="list-inline-item me-3">
                                        <i class="fas {{ 'fa-check-circle text-success' if s.match else 'fa-times-circle text-danger' }}"></i>
                                        <span class="ms-1">{{ s.name }}</span>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>

                            {% if candidate.match_reasons %}
                            <div class="mt-2">
                                <small class="text-muted">Selected because:</small>
                                {% for reason in candidate.match_reasons %}
                                    <span class="badge bg-light text-dark me-1">{{ reason }}</span>
                                {% endfor %}
                            </div>
                            {% endif %}

                            {% if candidate.missing_skills %}
                            <div class="mt-2">
                                <small class="text-muted">Missing skills:</small>
                                {% for miss in candidate.missing_skills %}
                                    <span class="badge bg-danger text-white me-1">{{ miss }}</span>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        <div class="text-end">
                            <span class="badge score-excellent score-badge">{{ candidate.match_score }}%</span>
                            {% if candidate.is_ai_generated %}
                            <div class="mt-1">
                                <span class="badge bg-warning text-dark">
                                    <i class="fas fa-robot me-1"></i>AI Detected
                                </span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-sm-6">
                                <small class="text-muted"><i class="fas fa-envelope me-2" style="color: #D44638;"></i>Email</small>
                                <p class="mb-1">{{ candidate.email or 'Not provided' }}</p>
                            </div>
                            <div class="col-sm-6">
                                <small class="text-muted"><i class="fas fa-phone me-2" style="color: #28a745;"></i>Phone</small>
                                <p class="mb-1">{{ candidate.phone or 'Not provided' }}</p>
                            </div>
                        </div>
                        <div class="mb-3">
                            <small class="text-muted"><i class="fas fa-bullseye me-2" style="color: #6f42c1;"></i>Target Role</small>
                            <p class="mb-1">
                                <span class="badge bg-primary">{{ candidate.target_role }}</span>
                            </p>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-6">
                                <small class="text-muted"><i class="fas fa-business-time me-2" style="color: #fd7e14;"></i>Experience</small>
                                <p class="mb-1">{{ candidate.experience }}</p>
                            </div>
                            <div class="col-sm-6">
                                <small class="text-muted"><i class="fas fa-graduation-cap me-2" style="color: #800000;"></i>Education</small>
                                <p class="mb-1">{{ candidate.education.title() if candidate.education else 'Not specified' }}</p>
                            </div>
                        </div>
                        {% if candidate.university %}
                        <div class="mb-3">
                            <small class="text-muted"><i class="fas fa-university me-2" style="color: #005A9C;"></i>University/College</small>
                            <p class="mb-1">{{ candidate.university }}</p>
                        </div>
                        {% endif %}
                        
                        <div class="mb-3">
                            <small class="text-muted"><i class="fas fa-certificate me-2" style="color: #ffc107;"></i>Certifications & Achievements</small>
                            {% if candidate.certifications_and_achievements %}
                            <ul class="list-unstyled">
                                {% for cert in candidate.certifications_and_achievements %}
                                <li>
                                    <i class="fas fa-award me-1 text-success"></i>
                                    {{ cert }}
                                </li>
                                {% endfor %}
                            </ul>
                            {% else %}
                            <p class="mb-1">Not mentioned</p>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            <small class="text-muted"><i class="fab fa-github me-1 text-dark"></i> GitHub</small>
                            {% if candidate.github_profiles %}
                            <ul class="list-unstyled mb-1">
                                {% for gh in candidate.github_profiles %}
                                <li>
                                    <a href="{{ gh.url }}" target="_blank">{{ gh.url }}</a>
                                    <small class="text-muted">({{ gh.source }})</small>
                                </li>
                                {% endfor %}
                            </ul>
                            {% else %}
                            <p class="mb-1">Not mentioned</p>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            <small class="text-muted"><i class="fab fa-linkedin me-1 text-primary"></i> LinkedIn</small>
                            {% if candidate.linkedin_profile %}
                            <p class="mb-1">
                                <a href="{{ candidate.linkedin_profile }}" target="_blank">{{ candidate.linkedin_profile }}</a>
                            </p>
                            {% else %}
                            <p class="mb-1">Not mentioned</p>
                            {% endif %}
                        </div>

                        <div class="row mb-3">
                            <div class="col-sm-6">
                                <small class="text-muted"><i class="fas fa-user-tie me-2" style="color: #2F4F4F;"></i>Internship</small>
                                <p class="mb-1">{{ 'Yes' if candidate.has_internship else 'No' }}</p>
                            </div>
                            <div class="col-sm-6">
                                <small class="text-muted"><i class="fas fa-laptop-code me-2" style="color: #0dcaf0;"></i>Hackathons</small>
                                <p class="mb-1">{{ 'Yes' if candidate.has_hackathon else 'No' }}</p>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <small class="text-muted"><i class="fas fa-tasks me-2" style="color: #e83e8c;"></i>Projects</small>
                            {% if candidate.projects %}
                            <ul class="list-unstyled">
                                {% for project in candidate.projects %}
                                <li>
                                    <i class="fas fa-code me-1 text-info"></i>
                                    {{ project }}
                                </li>
                                {% endfor %}
                            </ul>
                            {% else %}
                            <p class="mb-1">Not mentioned</p>
                            {% endif %}
                        </div>

                        {% if candidate.is_ai_generated %}
                        <div class="alert ai-warning py-2 mb-3">
                            <small>
                                <i class="fas fa-exclamation-triangle me-1"></i>
                                This resume may contain AI-generated content. Review carefully.
                            </small>
                        </div>
                        {% endif %}
                    </div>
                    <div class="card-footer">
                        <div class="d-flex gap-2">
                            <button class="btn btn-success email-btn" 
                                    onclick="sendEmail('{{ candidate.email }}', '{{ candidate.name }}', 'congratulations')">
                                <i class="fas fa-envelope me-1"></i>Congratulate
                            </button>
                            <button class="btn btn-outline-info btn-sm" 
                                    onclick="checkAI('{{ candidate.resume_filename }}')">
                                <i class="fas fa-search me-1"></i>AI Check
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if not_selected %}
    <div class="mb-5">
        <h2 class="text-danger mb-4">
            <i class="fas fa-times-circle me-2"></i>Not Selected Candidates ({{ not_selected|length }})
        </h2>
        <div class="row">
            {% for candidate in not_selected %}
            <div class="col-lg-6 mb-4">
                <div class="card candidate-card h-100">
                    <div class="card-header d-flex justify-content-between align-items-start">
                        <div>
                            <h5 class="card-title mb-1">
                                <i class="fas fa-user me-2"></i>{{ candidate.name }}
                            </h5>
                            <small class="text-muted">{{ candidate.resume_filename }}</small>
                            
                            <div class="mt-3">
                                <small class="text-muted">Skills Checklist</small>
                                <ul class="list-inline mt-2">
                                    {% for s in candidate.skills %}
                                    <li class="list-inline-item me-3">
                                        <i class="fas {{ 'fa-check-circle text-success' if s.match else 'fa-times-circle text-danger' }}"></i>
                                        <span class="ms-1">{{ s.name }}</span>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>

                            {% if candidate.missing_skills %}
                            <div class="mt-2">
                                <small class="text-muted">Missing skills:</small>
                                {% for miss in candidate.missing_skills %}
                                    <span class="badge bg-danger text-white me-1">{{ miss }}</span>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        <div class="text-end">
                            <span class="badge score-poor score-badge">{{ candidate.match_score }}%</span>
                            {% if candidate.is_ai_generated %}
                            <div class="mt-1">
                                <span class="badge bg-warning text-dark">
                                    <i class="fas fa-robot me-1"></i>AI Detected
                                </span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-sm-6">
                                <small class="text-muted"><i class="fas fa-envelope me-2" style="color: #D44638;"></i>Email</small>
                                <p class="mb-1">{{ candidate.email or 'Not provided' }}</p>
                            </div>
                            <div class="col-sm-6">
                                <small class="text-muted"><i class="fas fa-phone me-2" style="color: #28a745;"></i>Phone</small>
                                <p class="mb-1">{{ candidate.phone or 'Not provided' }}</p>
                            </div>
                        </div>
                        <div class="mb-3">
                            <small class="text-muted"><i class="fas fa-bullseye me-2" style="color: #6f42c1;"></i>Target Role</small>
                            <p class="mb-1">
                                <span class="badge bg-primary">{{ candidate.target_role }}</span>
                            </p>
                        </div>
                        <div class="row mb-3">
                            <div class="col-sm-6">
                                <small class="text-muted"><i class="fas fa-business-time me-2" style="color: #fd7e14;"></i>Experience</small>
                                <p class="mb-1">{{ candidate.experience }}</p>
                            </div>
                            <div class="col-sm-6">
                                <small class="text-muted"><i class="fas fa-graduation-cap me-2" style="color: #800000;"></i>Education</small>
                                <p class="mb-1">{{ candidate.education.title() if candidate.education else 'Not specified' }}</p>
                            </div>
                        </div>
                        {% if candidate.university %}
                        <div class="mb-3">
                            <small class="text-muted"><i class="fas fa-university me-2" style="color: #005A9C;"></i>University/College</small>
                            <p class="mb-1">{{ candidate.university }}</p>
                        </div>
                        {% endif %}
                        
                        <div class="mb-3">
                            <small class="text-muted"><i class="fas fa-certificate me-2" style="color: #ffc107;"></i>Certifications & Achievements</small>
                            {% if candidate.certifications_and_achievements %}
                            <ul class="list-unstyled">
                                {% for cert in candidate.certifications_and_achievements %}
                                <li>
                                    <i class="fas fa-award me-1 text-success"></i>
                                    {{ cert }}
                                </li>
                                {% endfor %}
                            </ul>
                            {% else %}
                            <p class="mb-1">Not mentioned</p>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            <small class="text-muted"><i class="fab fa-github me-1 text-dark"></i> GitHub</small>
                            {% if candidate.github_profiles %}
                            <ul class="list-unstyled mb-1">
                                {% for gh in candidate.github_profiles %}
                                <li>
                                    <a href="{{ gh.url }}" target="_blank">{{ gh.url }}</a>
                                    <small class="text-muted">({{ gh.source }})</small>
                                </li>
                                {% endfor %}
                            </ul>
                            {% else %}
                            <p class="mb-1">Not mentioned</p>
                            {% endif %}
                        </div>
                        
                        <div class="mb-3">
                            <small class="text-muted"><i class="fab fa-linkedin me-1 text-primary"></i> LinkedIn</small>
                            {% if candidate.linkedin_profile %}
                            <p class="mb-1">
                                <a href="{{ candidate.linkedin_profile }}" target="_blank">{{ candidate.linkedin_profile }}</a>
                            </p>
                            {% else %}
                            <p class="mb-1">Not mentioned</p>
                            {% endif %}
                        </div>

                        <div class="row mb-3">
                            <div class="col-sm-6">
                                <small class="text-muted"><i class="fas fa-user-tie me-2" style="color: #2F4F4F;"></i>Internship</small>
                                <p class="mb-1">{{ 'Yes' if candidate.has_internship else 'No' }}</p>
                            </div>
                            <div class="col-sm-6">
                                <small class="text-muted"><i class="fas fa-laptop-code me-2" style="color: #0dcaf0;"></i>Hackathons</small>
                                <p class="mb-1">{{ 'Yes' if candidate.has_hackathon else 'No' }}</p>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <small class="text-muted"><i class="fas fa-tasks me-2" style="color: #e83e8c;"></i>Projects</small>
                            {% if candidate.projects %}
                            <ul class="list-unstyled">
                                {% for project in candidate.projects %}
                                <li>
                                    <i class="fas fa-code me-1 text-info"></i>
                                    {{ project }}
                                </li>
                                {% endfor %}
                            </ul>
                            {% else %}
                            <p class="mb-1">Not mentioned</p>
                            {% endif %}
                        </div>

                        {% if candidate.is_ai_generated %}
                        <div class="alert ai-warning py-2 mb-3">
                            <small>
                                <i class="fas fa-exclamation-triangle me-1"></i>
                                This resume may contain AI-generated content. Review carefully.
                            </small>
                        </div>
                        {% endif %}
                    </div>
                    <div class="card-footer">
                        <div class="d-flex gap-2">
                            <button class="btn btn-outline-danger email-btn" 
                                    onclick="sendEmail('{{ candidate.email }}', '{{ candidate.name }}', 'rejection')">
                                <i class="fas fa-envelope me-1"></i>Send Rejection
                            </button>
                            <button class="btn btn-outline-info btn-sm" 
                                    onclick="checkAI('{{ candidate.resume_filename }}')">
                                <i class="fas fa-search me-1"></i>AI Check
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
function sendEmail(email, name, type) {
    if (!email) {
        showToast('No email address available for this candidate', 'warning');
        return;
    }
    
    const button = event.target;
    const originalText = button.innerHTML;
    button.disabled = true;
    button.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Sending...';
    
    fetch('/send_email', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            email: email,
            name: name,
            type: type
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast(`Email sent successfully to ${name}`, 'success');
            button.innerHTML = '<i class="fas fa-check me-1"></i>Sent';
        } else {
            showToast(`Failed to send email: ${data.message}`, 'danger');
            button.disabled = false;
            button.innerHTML = originalText;
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('Error sending email', 'danger');
        button.disabled = false;
        button.innerHTML = originalText;
    });
}

function checkAI(filename) {
    window.open(`/ai_check/${encodeURIComponent(filename)}`, '_blank');
}

function showToast(message, type) {
    const toastContainer = document.querySelector('.toast-container');
    const toastId = 'toast-' + Date.now();
    
    const toastHtml = `
        <div class="toast align-items-center text-bg-${type} border-0" role="alert" id="${toastId}">
            <div class="d-flex">
                <div class="toast-body">
                    ${message}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    `;
    
    toastContainer.insertAdjacentHTML('beforeend', toastHtml);
    
    const toastElement = document.getElementById(toastId);
    const toast = new bootstrap.Toast(toastElement);
    toast.show();
    
    toastElement.addEventListener('hidden.bs.toast', () => {
        toastElement.remove();
    });
}
</script>
</body>
</html>